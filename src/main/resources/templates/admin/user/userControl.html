<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="/project/plugin/element-ui/index.css">
    <!--引入vue-->
    <script src="/project/plugin/element-ui/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="/project/plugin/element-ui/index.js"></script>
    <!--引入axios-->
    <script src="/project/plugin/element-ui/axios.js"></script>
    <title>员工管理</title>
</head>
<body>
<div id="userTable">
    <div style="margin-bottom:10px;">
        <el-button  type="primary" @click="showEditWin">添加员工</el-button>
        <el-input style="width:300px;" v-model="keyword" ></el-input>
        <el-button type="success" @click="search"  icon="el-icon-search">搜索</el-button>
    </div>
    <el-table
            v-loading="vloading"
            :data="tableData"
            stripe border
            style="width: 100%">
        <el-table-column
                type="index"
                width="180">
        </el-table-column>
        <el-table-column
                prop="username"
                label="姓名"
                width="180">
        </el-table-column>
        <el-table-column
                prop="password"
                label="密码"
                width="180">
        </el-table-column>
        <el-table-column
                prop="rolename"
                label="职位">
        </el-table-column>
        <el-table-column label="操作">
            <template slot-scope="scope">
                <el-button
                        size="mini"
                        @click="handleEdit(scope.$index, scope.row)"
                >编辑</el-button>
                <el-button
                        size="mini"
                        type="danger"
                        @click="handleDelete(scope.$index, scope.row)"
                >删除</el-button>
            </template>
        </el-table-column>
    </el-table>
    <!--分页工具栏-->
        <el-pagination
                background
                layout="prev, pager, next"
                :total="total"
                @current-change="changePage">
        </el-pagination>
    <!--编辑用户的对话框-->
    <el-dialog
            :title="title"
            :visible.sync="dialogVisible"
            width="30%"
    >
        <el-form ref="form" :rules="rules" :model="form" label-width="80px">
            <el-form-item label="用户名:" prop="username">
                <input type="hidden" v-model="form.id"  >
                <el-input v-model="form.username"  suffix-icon="el-icon-date"></el-input>
            </el-form-item>
            <el-form-item label="密码:" prop="password">
                <el-input v-model="form.password" type="password"></el-input>
            </el-form-item>
            <el-form-item label="角色:" prop="roles">
                <el-select v-model="form.roles" placeholder="请选择" >
                    <el-option
                            v-for="item in roles"
                            :key="item.id"
                            :label="item.name"
                            :value="item.id">
                    </el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">

                        <el-button type="primary" @click="onSubmit('form')" icon="el-icon-upload2">确 定</el-button>
                          <el-button @click="resetForm('form')" icon="el-icon-refresh">重置</el-button>
                   </span>
    </el-dialog>
</div>

</body>
<script>
    axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
    Vue.prototype.$axios = axios;
    new Vue({
        el:"#userTable",
            data:{
                tableData:[],
                //控制对话框显示与否的属性
                dialogVisible:false,
                title:'新增用户',
                form:{
                    id:null,
                    username:'',
                    password:'',
                    roles:''
                },
                //声明校验规则
                rules:{
                    username:[
                        { required: true, message: '请输入用户名', trigger: 'blur' },
                        { min: 3, max: 10, message: '长度在 3 到 10 个字符', trigger: 'blur' }
                    ],
                    password:[
                        { required: true, message: '请输入密码', trigger: 'blur' }
                    ]
                },
                keyword:'',
                //控制是否显示加载中
                vloading:false,
                //当前页的变量
                currentPage:1,
                total:0,
                roles:[],
                roleValue:'1'
        },
        //当Vue组件加载完成之后调用这个函数
        mounted:function () {
            //加载数据表格
            var vue=this;
            //加载角色数据
            axios.get('listAllUser',{params:{keyword:this.keyword,currentPage:this.currentPage}})
                .then(function (res) {
                    vloading:false,
                    console.info(res.data);
                    //赋值总条数
                    vue.total=res.data.total;
                    //赋值分页数据
                    vue.tableData=res.data.rows();
                })
                .catch(function (error) {
                    vue.vloading=false;
                    Vue.prototype.$message.error("服务器产生异常，请联系管理员");
                });
        },
        methods: {
            showEditWin:function(){
                this.title='新增用户',
                    //显示编辑窗口
                    this.dialogVisible=true;
            },
            //添加员工事件

            //重置的事件
            resetForm:function(formName){
                this.$refs[formName].resetFields();
            },
            //点击分页数字时触发的事件
            changePage:function(changePage){
                this.currentPage=changePage;
                this.loadTableData();
            }
        },



    });
</script>

</html>